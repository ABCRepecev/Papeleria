<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Papeleria ABC</title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <header>
        <div>
            <div>
                <img src="img/logoABC.png" alt="Logo">
                <h1>SOLICITUD POR ÁREA DE PAPELERÍA EN ABC</h1>
            </div>
        </div>
        <span id="descripcion">Fecha máxima para enviar su solicitud de papelería es:</span>
        <span id="fecha"></span>
    </header>
    <main>
        <div id="formulDiv">
            <form action="Enviado/index.html" id="formulario" method="POST">
                <fieldset id="User">
                    <legend>Usuario</legend>
                    <label for="nombreU">Nombre usuario solicitante</label>
                    <input type="text" maxlength="30" name="nombreU" id="nombreU" required>
                    <label for="areaE">Área a la que pertenece</label>
                    <input type="text" maxlength="30" name="areaE" id="areaE" required>
                    <label for="sucursal">Sucursal</label>
                    <select name="sucursal" id="sucursal" required>
                        <option value="Bogotá" selected="selected">Portos Bogotá</option>
                        <option value="Bogotá" selected="selected">Zona franca Bogotá</option>
                        <option value="Bogotá" selected="selected">Intexona</option>
                        <option value="Barranquilla">Barranquilla</option>
                        <option value="Santa Marta">Santa Marta</option>
                        <option value="Cartagena">Cartagena</option>
                        <option value="Buenaventura">Buenaventura</option>
                        <option value="Cali">Cali</option>
                        <option value="Ipiales">Ipiales</option>
                    </select>
                    <label for="Empresa">Empresa</label>
                    <select name="Empresa" id="Empresa" requiered>
                        <option value="ABC Repecev">ABC Repecev</option>
                        <option value="ABC Cargo Logistic">ABC Cargo Logistic</option>
                        <option value="ABC Cargo Express">ABC Cargo Express</option>
                        <option value="ABC Storage">ABC Storage</option>
                        <option value="ABC SIC Logistic">ABC SIC Logistic</option>
                    </select>
                </fieldset>
                <fieldset id="formData">
                    <legend>Formulario de Solicitud</legend>
                    <table id="tabla">
                        <tr>
                            <th id="prove">Articulo</th>
                            <th>Valor</th>
                            <th>Tipo de empaque</th>
                            <th>Cantidad</th>
                        </tr>
                        <script src="js/formValues.js">
                        </script>
                        <button type="button" class="enviar" id="enviar">Enviar</button>
                    </table>
                    <script>
                        var rowCount = $('#tabla tr').length;
                        $(function () {
                            $("#enviar").click(function () {
                                let id_num = 0;
                                for (i = 0; i < rowCount - 1; i++) {
                                    if ($("#input-" + i).val() != "") {
                                        let total = parseInt($("#precio-" + i)[0].childNodes[0].nodeValue) * parseInt($("#input-" + i).val());
                                        let formData = {
                                            id: i+1,
                                            Articulo: $("#item-" + i)[0].childNodes[0].nodeValue,
                                            Precio: parseInt($("#precio-" + i)[0].childNodes[0].nodeValue),
                                            TipoDeEmpaque: $("#tipo-" + i)[0].childNodes[0].nodeValue,
                                            CantidadPedido: parseInt($("#input-" + i).val()),
                                            Total: total,
                                            UsuarioSolicitante: $("#nombreU").val(),
                                            AreaSolicitante: $("#areaE").val(),
                                            sucursal: $("#sucursal").val(),
                                            Empresa: $("#Empresa").val(),
                                        }
                                        $.ajax({
                                            contentType: 'application/json',
                                            type: "POST",
                                            url: "https://prod-61.westus.logic.azure.com:443/workflows/09a0d7c340bf4ca880fad49b94efb3c7/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=okc_L4zAB8ypmJqw9bA-SVvKx8wpZh7vBo1X9QUrLXI",
                                            data: JSON.stringify(formData),
                                        });
                                
                                    };
                                    if (i === rowCount - 2) {
                                        document.write("<body style='background-color:orange; display:flex; align-items:center; justify-content:center;'></body>")
                                        document.write("<div style='display:flex; padding:15px; flex-direction: column; background-color:white; border-radius: 5px;'><h2 style='color:#071d49; text-align:center;'>Su pedido fue enviado satisfactoriamente</h2><h3 style='color:darkgoldenrod; text-align:center;'>Fecha estimada de entrega: 06/6/2021</h3></div>")

                                    }
                                }
                            });
                        }
                        );
                    </script>
                </fieldset>
            </form>
        </div>
    </main>
    <footer id="footer">
        <p>
            Todos los derechos reservados para ABC
        </p>
        <p>
            Área administrativa
        </p>
    </footer>
</body>

</html>